
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>xfel.clustering package &#8212; CCTBX Developer documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CCTBX Developer documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">xfel.clustering package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xfel-clustering-package">
<h1>xfel.clustering package<a class="headerlink" href="#xfel-clustering-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-xfel.clustering.cluster">
<span id="xfel-clustering-cluster-module"></span><h2>xfel.clustering.cluster module<a class="headerlink" href="#module-xfel.clustering.cluster" title="Permalink to this headline">¶</a></h2>
<p>This module is designed to provide tools to deal with groups of serial
crystallography images.</p>
<p>The class Cluster allows the creation, storage and manipulation of these sets
of frames. Methods exist to create sub-clusters (new cluster objects) or to act
on an existing cluster, e.g. to plot the unit cell distributions.</p>
<p><strong>Author:</strong>   Oliver Zeldin &lt;<a class="reference external" href="mailto:zeldin&#37;&#52;&#48;stanford&#46;edu">zeldin<span>&#64;</span>stanford<span>&#46;</span>edu</a>&gt;</p>
<div class="section" id="cluster-cluster">
<h3>cluster.Cluster<a class="headerlink" href="#cluster-cluster" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="xfel.clustering.cluster.Cluster">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">xfel.clustering.cluster.</span></code><code class="sig-name descname"><span class="pre">Cluster</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference external" href="https://docs.python.org/3/library/functions.html#object" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></a></p>
<p>Class for operation on groups of single XFEL images (here described by
SingleFrame objects) as cluster objects.</p>
<p>Objects can be created directily using the __init__ method, or by using a
classmethod e.g. to create an object from a folder full of integration
pickles. Whenever a method can plot, there is the option of
passing it an appropriate number of matplotlib axes objects, which will then
get returned for use in composite plots. See cluster.42 for an example.
If no axes are passed, the methods will just plot the result to the screen.
Clustering filters can act on these to break them up into cluster objects with
different members. A ‘filter’ is just a clustering procedure that puts the
passes and fails into different clusters. This is acheived through the
make_sub_cluster() method. This also keeps track of a sub-clusters heritage
through the .info string, which is appended to. The idea is to be able to
write filter scripts for each data.
e.g</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">test_cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="o">.</span><span class="n">from_directories</span><span class="p">([</span><span class="s2">&quot;~/test_data&quot;</span><span class="p">],</span>
<span class="gp">... </span>                                       <span class="s1">&#39;test_script&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">P3_only</span> <span class="o">=</span> <span class="n">test_cluster</span><span class="o">.</span><span class="n">point_group_filer</span><span class="p">(</span><span class="s1">&#39;P3&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_clusters</span> <span class="o">=</span> <span class="n">P3_only</span><span class="o">.</span><span class="n">ab_cluster</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">big_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sub_clusters</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">members</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">best_data</span> <span class="o">=</span> <span class="n">big_cluster</span><span class="o">.</span><span class="n">total_intensity_filter</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span>
<span class="gp">... </span>                                              <span class="n">completeness_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="gp">... </span>                                              <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">best_data</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
<p>Subsequent postrefinenment/merging programs can be called on an output
cluster.lst file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; prime.postrefine params.phil $(cat cluster.lst)
</pre></div>
</div>
<dl class="py attribute">
<dt id="xfel.clustering.cluster.Cluster.__dict__">
<code class="sig-name descname"><span class="pre">__dict__</span></code><em class="property"> <span class="pre">=</span> <span class="pre">mappingproxy({'__module__':</span> <span class="pre">'xfel.clustering.cluster',</span> <span class="pre">'__doc__':</span> <span class="pre">'Class</span> <span class="pre">for</span> <span class="pre">operation</span> <span class="pre">on</span> <span class="pre">groups</span> <span class="pre">of</span> <span class="pre">single</span> <span class="pre">XFEL</span> <span class="pre">images</span> <span class="pre">(here</span> <span class="pre">described</span> <span class="pre">by\n</span>&#160; <span class="pre">SingleFrame</span> <span class="pre">objects)</span> <span class="pre">as</span> <span class="pre">cluster</span> <span class="pre">objects.\n\n</span>&#160; <span class="pre">Objects</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">created</span> <span class="pre">directily</span> <span class="pre">using</span> <span class="pre">the</span> <span class="pre">__init__</span> <span class="pre">method,</span> <span class="pre">or</span> <span class="pre">by</span> <span class="pre">using</span> <span class="pre">a\n</span>&#160; <span class="pre">classmethod</span> <span class="pre">e.g.</span> <span class="pre">to</span> <span class="pre">create</span> <span class="pre">an</span> <span class="pre">object</span> <span class="pre">from</span> <span class="pre">a</span> <span class="pre">folder</span> <span class="pre">full</span> <span class="pre">of</span> <span class="pre">integration\n</span>&#160; <span class="pre">pickles.</span> <span class="pre">Whenever</span> <span class="pre">a</span> <span class="pre">method</span> <span class="pre">can</span> <span class="pre">plot,</span> <span class="pre">there</span> <span class="pre">is</span> <span class="pre">the</span> <span class="pre">option</span> <span class="pre">of\n</span>&#160; <span class="pre">passing</span> <span class="pre">it</span> <span class="pre">an</span> <span class="pre">appropriate</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">matplotlib</span> <span class="pre">axes</span> <span class="pre">objects,</span> <span class="pre">which</span> <span class="pre">will</span> <span class="pre">then\n</span>&#160; <span class="pre">get</span> <span class="pre">returned</span> <span class="pre">for</span> <span class="pre">use</span> <span class="pre">in</span> <span class="pre">composite</span> <span class="pre">plots.</span> <span class="pre">See</span> <span class="pre">cluster.42</span> <span class="pre">for</span> <span class="pre">an</span> <span class="pre">example.\n</span>&#160; <span class="pre">If</span> <span class="pre">no</span> <span class="pre">axes</span> <span class="pre">are</span> <span class="pre">passed,</span> <span class="pre">the</span> <span class="pre">methods</span> <span class="pre">will</span> <span class="pre">just</span> <span class="pre">plot</span> <span class="pre">the</span> <span class="pre">result</span> <span class="pre">to</span> <span class="pre">the</span> <span class="pre">screen.\n</span>&#160; <span class="pre">Clustering</span> <span class="pre">filters</span> <span class="pre">can</span> <span class="pre">act</span> <span class="pre">on</span> <span class="pre">these</span> <span class="pre">to</span> <span class="pre">break</span> <span class="pre">them</span> <span class="pre">up</span> <span class="pre">into</span> <span class="pre">cluster</span> <span class="pre">objects</span> <span class="pre">with\n</span>&#160; <span class="pre">different</span> <span class="pre">members.</span> <span class="pre">A</span> <span class="pre">\'filter\'</span> <span class="pre">is</span> <span class="pre">just</span> <span class="pre">a</span> <span class="pre">clustering</span> <span class="pre">procedure</span> <span class="pre">that</span> <span class="pre">puts</span> <span class="pre">the\n</span>&#160; <span class="pre">passes</span> <span class="pre">and</span> <span class="pre">fails</span> <span class="pre">into</span> <span class="pre">different</span> <span class="pre">clusters.</span> <span class="pre">This</span> <span class="pre">is</span> <span class="pre">acheived</span> <span class="pre">through</span> <span class="pre">the\n</span>&#160; <span class="pre">make_sub_cluster()</span> <span class="pre">method.</span> <span class="pre">This</span> <span class="pre">also</span> <span class="pre">keeps</span> <span class="pre">track</span> <span class="pre">of</span> <span class="pre">a</span> <span class="pre">sub-clusters</span> <span class="pre">heritage\n</span>&#160; <span class="pre">through</span> <span class="pre">the</span> <span class="pre">.info</span> <span class="pre">string,</span> <span class="pre">which</span> <span class="pre">is</span> <span class="pre">appended</span> <span class="pre">to.</span> <span class="pre">The</span> <span class="pre">idea</span> <span class="pre">is</span> <span class="pre">to</span> <span class="pre">be</span> <span class="pre">able</span> <span class="pre">to\n</span>&#160; <span class="pre">write</span> <span class="pre">filter</span> <span class="pre">scripts</span> <span class="pre">for</span> <span class="pre">each</span> <span class="pre">data.\n</span>&#160; <span class="pre">e.g</span> <span class="pre">::\n\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">test_cluster</span> <span class="pre">=</span> <span class="pre">Cluster.from_directories([&quot;~/test_data&quot;],\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">...</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">\'test_script\')\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">P3_only</span> <span class="pre">=</span> <span class="pre">test_cluster.point_group_filer(\'P3\')\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">sub_clusters</span> <span class="pre">=</span> <span class="pre">P3_only.ab_cluster(1200)\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">big_cluster</span> <span class="pre">=</span> <span class="pre">max(sub_clusters,</span> <span class="pre">key=lambda</span> <span class="pre">x:</span> <span class="pre">len(x.members))\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">best_data</span> <span class="pre">=</span> <span class="pre">big_cluster.total_intensity_filter(res=6.5,\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">...</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">completeness_threshold=0.1,\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">...</span>&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; <span class="pre">plot=False)\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">print</span> <span class="pre">best_data.info\n\n</span>&#160; <span class="pre">Subsequent</span> <span class="pre">postrefinenment/merging</span> <span class="pre">programs</span> <span class="pre">can</span> <span class="pre">be</span> <span class="pre">called</span> <span class="pre">on</span> <span class="pre">an</span> <span class="pre">output\n</span>&#160; <span class="pre">cluster.lst</span> <span class="pre">file::\n</span>&#160;&#160;&#160;&#160;&#160; <span class="pre">&gt;&gt;&gt;</span> <span class="pre">prime.postrefine</span> <span class="pre">params.phil</span> <span class="pre">$(cat</span> <span class="pre">cluster.lst)\n</span>&#160; <span class="pre">',</span> <span class="pre">'__init__':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.__init__&gt;,</span> <span class="pre">'from_directories':</span> <span class="pre">&lt;classmethod</span> <span class="pre">object&gt;,</span> <span class="pre">'from_crystal_symmetries':</span> <span class="pre">&lt;classmethod</span> <span class="pre">object&gt;,</span> <span class="pre">'from_list':</span> <span class="pre">&lt;classmethod</span> <span class="pre">object&gt;,</span> <span class="pre">'from_iterable':</span> <span class="pre">&lt;classmethod</span> <span class="pre">object&gt;,</span> <span class="pre">'from_files':</span> <span class="pre">&lt;classmethod</span> <span class="pre">object&gt;,</span> <span class="pre">'from_expts':</span> <span class="pre">&lt;classmethod</span> <span class="pre">object&gt;,</span> <span class="pre">'make_sub_cluster':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.make_sub_cluster&gt;,</span> <span class="pre">'best_by_CC':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.best_by_CC&gt;,</span> <span class="pre">'print_ucs':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.print_ucs&gt;,</span> <span class="pre">'point_group_filter':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.point_group_filter&gt;,</span> <span class="pre">'total_intensity_filter':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.total_intensity_filter&gt;,</span> <span class="pre">'ab_cluster':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.ab_cluster&gt;,</span> <span class="pre">'dump_file_list':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.dump_file_list&gt;,</span> <span class="pre">'visualise_orientational_distribution':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.visualise_orientational_distribution&gt;,</span> <span class="pre">'intensity_statistics':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.intensity_statistics&gt;,</span> <span class="pre">'all_frames_intensity_stats':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.all_frames_intensity_stats&gt;,</span> <span class="pre">'merge_dict':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.merge_dict&gt;,</span> <span class="pre">'__len__':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.__len__&gt;,</span> <span class="pre">'dump_as_mtz':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.dump_as_mtz&gt;,</span> <span class="pre">'to_pandas':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.to_pandas&gt;,</span> <span class="pre">'uc_feature_vector':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.uc_feature_vector&gt;,</span> <span class="pre">'prime_postrefine':</span> <span class="pre">&lt;function</span> <span class="pre">Cluster.prime_postrefine&gt;,</span> <span class="pre">'__dict__':</span> <span class="pre">&lt;attribute</span> <span class="pre">'__dict__'</span> <span class="pre">of</span> <span class="pre">'Cluster'</span> <span class="pre">objects&gt;,</span> <span class="pre">'__weakref__':</span> <span class="pre">&lt;attribute</span> <span class="pre">'__weakref__'</span> <span class="pre">of</span> <span class="pre">'Cluster'</span> <span class="pre">objects&gt;,</span> <span class="pre">'__annotations__':</span> <span class="pre">{}})</span></em><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__dict__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.__init__">
<code class="sig-name descname"><span class="pre">__init__</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cname</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a cluster from a list of SingleFrame objects, as well as information
about these as a cluster (e.g. mean unit cell).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – a list of SingleFrame objects</p></li>
<li><p><strong>cname</strong> – the name of the cluster, as a string.</p></li>
<li><p><strong>info</strong> – an info-string for the cluster.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.__len__">
<code class="sig-name descname"><span class="pre">__len__</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__len__" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of images in the cluster</p>
</dd></dl>

<dl class="py attribute">
<dt id="xfel.clustering.cluster.Cluster.__module__">
<code class="sig-name descname"><span class="pre">__module__</span></code><em class="property"> <span class="pre">=</span> <span class="pre">'xfel.clustering.cluster'</span></em><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__module__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="xfel.clustering.cluster.Cluster.__weakref__">
<code class="sig-name descname"><span class="pre">__weakref__</span></code><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__weakref__" title="Permalink to this definition">¶</a></dt>
<dd><p>list of weak references to the object (if defined)</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.ab_cluster">
<code class="sig-name descname"><span class="pre">ab_cluster</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'distance'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">linkage_method</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'single'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">log</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">write_file_lists</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">schnell</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">doplot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'default'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.ab_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Hierarchical clustering using the unit cell dimentions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>threshold</strong> – the threshold to use for prunning the tree into clusters.</p></li>
<li><p><strong>method</strong> – which clustering method from scipy to use when creating the tree (see scipy.cluster.hierarchy)</p></li>
<li><p><strong>linkage_method</strong> – which linkage method from scipy to use when creating the linkages. x (see scipy.cluster.hierarchy)</p></li>
<li><p><strong>log</strong> – if True, use log scale on y axis.</p></li>
<li><p><strong>ax</strong> – if a matplotlib axes object is provided, plot to this. Otherwise, create a new axes object and display on screen.</p></li>
<li><p><strong>write_file_lists</strong> – if True, write out the files that make up each cluster.</p></li>
<li><p><strong>schnell</strong> – if True, use simple euclidian distance, otherwise, use Andrews-Berstein distance from Andrews &amp; Bernstein J Appl Cryst 47:346 (2014) on the Niggli cells.</p></li>
<li><p><strong>doplot</strong> – Boolean flag for if the plotting should be done at all.</p></li>
</ul>
</dd>
</dl>
<p>Runs faster if switched off.
:param labels: ‘default’ will not display any labels for more than 100 images, but will display file names for fewer. This can be manually overidden with a boolean flag.
:return: A list of Clusters ordered by largest Cluster to smallest</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Use ‘schnell’ option with caution, since it can cause strange behaviour
around symmetry boundaries.</p>
</div>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.all_frames_intensity_stats">
<code class="sig-name descname"><span class="pre">all_frames_intensity_stats</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">smoothing_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.all_frames_intensity_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Goes through all frames in the cluster, and plots all the partial intensites.
Then does a linear fit and rolling average on these.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>smoothing_width</strong> – the width of the smoothing window.</p></li>
<li><p><strong>ax</strong> – Optional matplotlib axes object to plot to. Otherwise, plot to screen.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the axis, with the data plotted onto it.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.best_by_CC">
<code class="sig-name descname"><span class="pre">best_by_CC</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">assert_is_similar_symmetry</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.best_by_CC" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the SingleFrame object with the highest CC to a reference miller array.
:param other: miller array object to be correlated against
:return: a SingleFrame object.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.dump_as_mtz">
<code class="sig-name descname"><span class="pre">dump_as_mtz</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mtz_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_fullies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.dump_as_mtz" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge using weighted mean and standard deviation if all miller arrays</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.dump_file_list">
<code class="sig-name descname"><span class="pre">dump_file_list</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">out_file_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.dump_file_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Dumps a list of paths to inegration pickle files to a file. One
line per image. Provides easy input into post-refinement programs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>out_file_name</strong> – the output file name.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.from_crystal_symmetries">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">from_crystal_symmetries</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">crystal_symmetries</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lattice_ids</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster_from_crystal_symmetries'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Made</span> <span class="pre">from</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">individual</span> <span class="pre">cells'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_images</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_crystal_symmetries" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from a list of crystal symmetries.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.from_directories">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">from_directories</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path_to_integration_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster_from_dir'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_images</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_directories" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from pickle files, from the recursively
walked paths. Can take more than one argument for multiple folders.
usage: Cluster.from_directories(..)
:param path_to_integration_dir: list of directories containing pickle files.
Will be searched recursively.
:param n_images: find at most this number of images.
:param use_b: Boolean. If True, intialise Scale and B. If False, use only
mean intensity scalling.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.from_expts">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">from_expts</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">refl_table</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">expts_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster_from_file'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Made</span> <span class="pre">from</span> <span class="pre">experiment</span> <span class="pre">objects'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_images</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_expts" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from experiment and reflection list objects
:param refl_table: DIALS integrated reflection table
:param expts_list: DIALS experiment list
:param n_images: find at most this number of images</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.from_files">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">from_files</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">raw_input</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pickle_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials_refls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials_expts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster_from_file'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Made</span> <span class="pre">from</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">individual</span> <span class="pre">files'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_images</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">json</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from a list of individual files.
:param pickle_list: list of pickle files
:param dials_refls: list of DIALS integrated reflections
:param dials_expts: list of DIALS experiment jsons
:param n_images: find at most this number of images
:param dials: use the dials_refls and dials_expts arguments to construct the clusters (default: False)
:param use_b: Boolean. If True, intialise Scale and B. If False, use only
mean intensity scalling.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.from_iterable">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">from_iterable</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iterable</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster_from_iterable'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Made</span> <span class="pre">from</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">individual</span> <span class="pre">cells'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_iterable" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from an iterable (a list or tuple).  The
file must list unit cell a,b,c,alpha,beta,gamma and space_group_type,
each as a single token.
:param iterable: a list or a tuple</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.from_list">
<em class="property"><span class="pre">classmethod</span> </em><code class="sig-name descname"><span class="pre">from_list</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">file_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">raw_input</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pickle_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials_refls</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials_expts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_prefix</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cluster_from_file'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">_message</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'Made</span> <span class="pre">from</span> <span class="pre">list</span> <span class="pre">of</span> <span class="pre">individual</span> <span class="pre">cells'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_images</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from a single file.  The file must list unit cell a,b,c,alpha,beta,gamma
and space_group_type, each as a single token.
:param file_name: pathname of the file</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.intensity_statistics">
<code class="sig-name descname"><span class="pre">intensity_statistics</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.intensity_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses the per-frame B and G fits (gradient and intercept of the ln(i) vs
(sin(theta)/lambda)**2 plot) to create three agregate plots:
1) histogram of standard errors on the per-frame fits
2) histogram of B factors
3) scatter  plot of intercept vs. gradient (G vs. B)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ax</strong> – optionally hand the method three matplotlib axes objects to plot onto. If not specified, will plot the data.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>the three axes, with the data plotted onto them.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.make_sub_cluster">
<code class="sig-name descname"><span class="pre">make_sub_cluster</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">new_members</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_prefix</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_info</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.make_sub_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a sub-cluster from a list of SingleFrame objects from the old
SingleFrame array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>new_members</strong> – a new set of SingleFrame objects, typically a subset of</p>
</dd>
</dl>
<p>the current cluster.
:param new_prefix: prefix to be passed directly to __init__
:param new_info: new information about this cluster. This is inteligently
appended to the old info string so that the history of sub-clusters is
tracted.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.merge_dict">
<code class="sig-name descname"><span class="pre">merge_dict</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_fullies</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.merge_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a dict of Miller indices with  ([list of intensities], resolution)
value tuples for each miller index.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.point_group_filter">
<code class="sig-name descname"><span class="pre">point_group_filter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">point_group</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.point_group_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all the SingleFrames that have a given pointgroup.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.prime_postrefine">
<code class="sig-name descname"><span class="pre">prime_postrefine</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputfile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.prime_postrefine" title="Permalink to this definition">¶</a></dt>
<dd><p>Run postrefinement from Prime on a cluster. Implements the prime API, and updates the SingleFrame objects with the attribute <cite>miller_fullies</cite>.
:param cluster: a cluster object.
:param inputfile: a Prime .inp file.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.print_ucs">
<code class="sig-name descname"><span class="pre">print_ucs</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.print_ucs" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints a list of all the unit cells in the cluster to CSV.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.to_pandas">
<code class="sig-name descname"><span class="pre">to_pandas</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.to_pandas" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.total_intensity_filter">
<code class="sig-name descname"><span class="pre">total_intensity_filter</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">res</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">completeness_threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.total_intensity_filter" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is still in development, use at own risk!</p>
</div>
<p>Creates an optimal sub-cluster using the fewest images that fulfil the
criteria defined by:
:param res: desired resolution. Defaults to that of the dataset.
:param completeness: the desired completeness of the subset
:param multiplicity: the desired multiplicity of the subset</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.uc_feature_vector">
<code class="sig-name descname"><span class="pre">uc_feature_vector</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.uc_feature_vector" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a len(cluster) * 6 numpy array of features for use in ML algos</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.cluster.Cluster.visualise_orientational_distribution">
<code class="sig-name descname"><span class="pre">visualise_orientational_distribution</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">axes_to_return</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cbar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.visualise_orientational_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a plot of the orientational distribution of the unit cells.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>axes_to_return</strong> – if None, print to screen, otherwise, requires 3 axes objects, and will return them.</p></li>
<li><p><strong>cbar</strong> – boolean to specify if a color bar should be used.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-xfel.clustering.cluster_groups">
<span id="xfel-clustering-cluster-groups-module"></span><h2>xfel.clustering.cluster_groups module<a class="headerlink" href="#module-xfel.clustering.cluster_groups" title="Permalink to this headline">¶</a></h2>
<p>Utilitites for dealing with lists of clusters.</p>
<dl class="py function">
<dt id="xfel.clustering.cluster_groups.unit_cell_info">
<code class="sig-prename descclassname"><span class="pre">xfel.clustering.cluster_groups.</span></code><code class="sig-name descname"><span class="pre">unit_cell_info</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sub_clusters</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster_groups.unit_cell_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Print unit cell information for a list of clusters.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>sub_clusters</strong> – a list of cluster objects</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a string containing median unit cells, standard deviations and
point group composition of each cluster.</p>
</dd>
</dl>
</dd></dl>

</div>
<div class="section" id="module-xfel.clustering.singleframe">
<span id="xfel-clustering-singleframe-module"></span><h2>xfel.clustering.singleframe module<a class="headerlink" href="#module-xfel.clustering.singleframe" title="Permalink to this headline">¶</a></h2>
<p>Module for working with single images in a serial crystallography
dataset</p>
<div class="section" id="singleframe-singleframe">
<h3>singleframe.SingleFrame<a class="headerlink" href="#singleframe-singleframe" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="xfel.clustering.singleframe.SingleFrame">
<em class="property"><span class="pre">class</span> </em><code class="sig-prename descclassname"><span class="pre">xfel.clustering.singleframe.</span></code><code class="sig-name descname"><span class="pre">SingleFrame</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crystal_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_negative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_b</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dicti</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pixel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">xfel.clustering.api.InputFrame</span></code></p>
<p>Class that creates single-image agregate metrics/scoring that can then be
used in downstream clustering or filtering procedures.</p>
<dl class="py attribute">
<dt id="xfel.clustering.singleframe.SingleFrame.ANGSTROMS_TO_EV">
<code class="sig-name descname"><span class="pre">ANGSTROMS_TO_EV</span></code><em class="property"> <span class="pre">=</span> <span class="pre">12398.425</span></em><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.ANGSTROMS_TO_EV" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.__init__">
<code class="sig-name descname"><span class="pre">__init__</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">crystal_num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">remove_negative</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">use_b</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dicti</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pixel_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor for SingleFrame object, using a cctbx.xfel integration pickle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – path to integration pickle</p></li>
<li><p><strong>filename</strong> – the file name alone (used as a label)</p></li>
<li><p><strong>crystal_num</strong> – if multiple lattices present, the latice number.</p></li>
<li><p><strong>remove_negative</strong> – Boolean for removal of negative intensities</p></li>
<li><p><strong>use_b</strong> – if True, initialise scale and B, if false, use only mean-intensity scaling.</p></li>
<li><p><strong>dicti</strong> – optional. If a dictionairy is supplied here, will create object from that rather than attempting to read the file specified in path, filename.</p></li>
<li><p><strong>pixel_size</strong> – the size of pixels in mm. Defaults to a MAR detector with a warning at debug level of logging.</p></li>
<li><p><strong>scale</strong> – if False, will intialise scales to G=1, B=0.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>a SingleFrame object, with the following Object attributes:</p>
</dd>
</dl>
<dl class="simple">
<dt>Object attributes are:</dt><dd><ul class="simple">
<li><p><cite>is_polarization_corrected</cite>: Boolean flag indicatinf if polarization correction has been applied</p></li>
<li><p><cite>miller_array</cite>: the cctbx.miller miller array of spot intensities.</p></li>
<li><p><cite>mapped_predictions</cite>: the mapped_predictions locations</p></li>
<li><p><cite>path</cite>: full path to the original file</p></li>
<li><p><cite>name</cite>: file-name, used as an identifier</p></li>
<li><p><a href="#id1"><span class="problematic" id="id2">`</span></a>crystal_system:</p></li>
<li><p><cite>pg</cite>: point group of pickle</p></li>
<li><p><cite>uc</cite>: Niggli unit cell as a tuple</p></li>
<li><p><cite>orientation</cite>: cctbx crystal_orientation object</p></li>
<li><p><cite>total_i</cite>: the total integrated intensity for this frame</p></li>
<li><p><cite>xbeam</cite>: x-location of beam centre</p></li>
<li><p><cite>ybeam</cite>: y-location of beam centre</p></li>
<li><p><a href="#id3"><span class="problematic" id="id4">`</span></a>wavelength:</p></li>
<li><p><cite>spot_offset</cite>: the mean offset between observed spots and predicted centroids. Only created if integration was performed using verbose_cv=True. Otherwise None.</p></li>
<li><p><cite>minus_2B</cite>: the gradient of the ln(i) vs. sinsqtheta_over_lambda_sq plot</p></li>
<li><p><cite>G</cite>: intercept of the of the ln(i) vs. sinsqtheta_over_lambda_sq plot</p></li>
<li><p><cite>log_i</cite>: list of log_i intensities</p></li>
<li><p><cite>sinsqtheta_over_lambda_sq</cite>: list of sinsqtheta_over_lambda_sq</p></li>
<li><p><cite>wilson_err</cite>: standard error on the fit of ln(i) vs. sinsqtheta_over_lambda_sq</p></li>
<li><p><cite>miller_fullies</cite>: a cctbx.miller array of fully recorded intensites.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt id="xfel.clustering.singleframe.SingleFrame.__module__">
<code class="sig-name descname"><span class="pre">__module__</span></code><em class="property"> <span class="pre">=</span> <span class="pre">'xfel.clustering.singleframe'</span></em><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.__module__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.distance_from">
<code class="sig-name descname"><span class="pre">distance_from</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">other_uc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.distance_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates distance using NCDist from Andrews and Bernstein J. Appl.
Cryst. 2014 between this frame and some other unit cell.
:param:other_uc: a 6-tuple of a, b, c, alpha, beta, gamma for some unit cell
:return: the NCDist in A^2 to other_uc</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.filter_negative_intensities">
<code class="sig-name descname"><span class="pre">filter_negative_intensities</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.filter_negative_intensities" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters negative intensities from the Miller array. Acts in place.
:return: acts in place.</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.init_calc_wilson">
<code class="sig-name descname"><span class="pre">init_calc_wilson</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">use_b_factor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">i_corrections</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.init_calc_wilson" title="Permalink to this definition">¶</a></dt>
<dd><p>If use_b_factor is
:param i_corrections: allows flex array of correction factors (e.g. partialities) to be specified
:param use_b_factor: if True, do a linear regression to fit G and B and returns the coeficients minus_2B, G, the transformed data log_i, and one_over_d_sqare. Also returns fit_stats, which is a dictionairy. If use_b_factor is False, then B is 0, and G is the mean intensity of the image. The r_value is then 0 (by definition), and the std_err is the standard error on the mean.</p>
<dl class="field-list simple">
<dt class="field-odd">Return minus_2B, G, log_i, on_over_d_square</dt>
<dd class="field-odd"><p><cite>minus_2B</cite>: gradient of fit; <cite>G</cite>: intercept of fit; <cite>log_i</cite>: dependent variable of fit; <cite>one_over_d_square</cite>: independent variable of fit.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.make_g6">
<em class="property"><span class="pre">static</span> </em><code class="sig-name descname"><span class="pre">make_g6</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uc</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.make_g6" title="Permalink to this definition">¶</a></dt>
<dd><p>Take a reduced Niggli Cell, and turn it into the G6 representation. This is
similar but not identical to the metrical matrix.  See
doi:10.1107/S0567739473001063 Gruber (1973)
doi:10.1107/S0108767388006427 Andrews and Bernstein (1988)
doi:10.1107/S1600576713031002 Andrews and Bernstein (2014)</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.n_reflections_by_sigi">
<code class="sig-name descname"><span class="pre">n_reflections_by_sigi</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sig_i_cuttoff</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.n_reflections_by_sigi" title="Permalink to this definition">¶</a></dt>
<dd><p>Currently a placeholder that returns None.</p>
<p>This method should return the number of reflection in the frame that have an
I/sig(I) &gt; sig_i_cuttoff</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.plot_wilson">
<code class="sig-name descname"><span class="pre">plot_wilson</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.plot_wilson" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a log(I) vs 1/d**2 plot, displaying the raw partial data, a
rolling average of the data, and the Wilson model fit to the data.</p>
<dl class="field-list simple">
<dt class="field-odd">Param</dt>
<dd class="field-odd"><p>width: smoothing window size</p>
</dd>
<dt class="field-even">Param</dt>
<dd class="field-even"><p>ax: optional axes object to ve used for plotting</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.polarization_correction">
<code class="sig-name descname"><span class="pre">polarization_correction</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.polarization_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform basic polarization correction in place, and change the
is_polarization_corrected flag to True.</p>
<p>I_corrected = 2*I_uncorrected/(1 + cos(two_theta)**2)</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.to_panda">
<code class="sig-name descname"><span class="pre">to_panda</span></code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.to_panda" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the object attributes as a pandas series</p>
</dd></dl>

<dl class="py method">
<dt id="xfel.clustering.singleframe.SingleFrame.trim_res_limit">
<code class="sig-name descname"><span class="pre">trim_res_limit</span></code><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">d_min</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.trim_res_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all miller indicies outside the range of _d_min, _d_max.
Changes the object in place.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>d_min</strong> – min res of new miller array. Defaults to current value.</p></li>
<li><p><strong>d_max</strong> – max res of new miller array. Defaults to current value.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">xfel.clustering package</a><ul>
<li><a class="reference internal" href="#module-xfel.clustering.cluster">xfel.clustering.cluster module</a><ul>
<li><a class="reference internal" href="#cluster-cluster">cluster.Cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-xfel.clustering.cluster_groups">xfel.clustering.cluster_groups module</a></li>
<li><a class="reference internal" href="#module-xfel.clustering.singleframe">xfel.clustering.singleframe module</a><ul>
<li><a class="reference internal" href="#singleframe-singleframe">singleframe.SingleFrame</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/xfel/xfel.clustering.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CCTBX Developer documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">xfel.clustering package</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, University of California.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.5.2.
    </div>
  </body>
</html>