
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>xfel.clustering package &#8212; CCTBX Developer documentation</title>
    <link rel="stylesheet" href="../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CCTBX Developer documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="xfel-clustering-package">
<h1>xfel.clustering package<a class="headerlink" href="#xfel-clustering-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-xfel.clustering.cluster">
<span id="xfel-clustering-cluster-module"></span><h2>xfel.clustering.cluster module<a class="headerlink" href="#module-xfel.clustering.cluster" title="Permalink to this headline">¶</a></h2>
<p>This module is designed to provide tools to deal with groups of serial
crystallography images.</p>
<p>The class Cluster allows the creation, storage and manipulation of these sets
of frames. Methods exist to create sub-clusters (new cluster objects) or to act
on an existing cluster, e.g. to plot the unit cell distributions.</p>
<p><strong>Author:</strong>   Oliver Zeldin &lt;<a class="reference external" href="mailto:zeldin&#37;&#52;&#48;stanford&#46;edu">zeldin<span>&#64;</span>stanford<span>&#46;</span>edu</a>&gt;</p>
<div class="section" id="cluster-cluster">
<h3>cluster.Cluster<a class="headerlink" href="#cluster-cluster" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="xfel.clustering.cluster.Cluster">
<em class="property">class </em><code class="descclassname">xfel.clustering.cluster.</code><code class="descname">Cluster</code><span class="sig-paren">(</span><em>data</em>, <em>cname='cluster'</em>, <em>info=''</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Class for operation on groups of single XFEL images (here described by
SingleFrame objects) as cluster objects.</p>
<p>Objects can be created directily using the __init__ method, or by using a
classmethod e.g. to create an object from a folder full of integration
pickles. Whenever a method can plot, there is the option of
passing it an appropriate number of matplotlib axes objects, which will then
get returned for use in composite plots. See cluster.42 for an example.
If no axes are passed, the methods will just plot the result to the screen.
Clustering filters can act on these to break them up into cluster objects with
different members. A ‘filter’ is just a clustering procedure that puts the
passes and fails into different clusters. This is acheived through the
make_sub_cluster() method. This also keeps track of a sub-clusters heritage
through the .info string, which is appended to. The idea is to be able to
write filter scripts for each data.
e.g</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">test_cluster</span> <span class="o">=</span> <span class="n">Cluster</span><span class="o">.</span><span class="n">from_directories</span><span class="p">([</span><span class="s2">&quot;~/test_data&quot;</span><span class="p">],</span>
<span class="gp">... </span>                                       <span class="s1">&#39;test_script&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">P3_only</span> <span class="o">=</span> <span class="n">test_cluster</span><span class="o">.</span><span class="n">point_group_filer</span><span class="p">(</span><span class="s1">&#39;P3&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sub_clusters</span> <span class="o">=</span> <span class="n">P3_only</span><span class="o">.</span><span class="n">ab_cluster</span><span class="p">(</span><span class="mi">1200</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">big_cluster</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sub_clusters</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">members</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">best_data</span> <span class="o">=</span> <span class="n">big_cluster</span><span class="o">.</span><span class="n">total_intensity_filter</span><span class="p">(</span><span class="n">res</span><span class="o">=</span><span class="mf">6.5</span><span class="p">,</span>
<span class="gp">... </span>                                              <span class="n">completeness_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
<span class="gp">... </span>                                              <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="n">best_data</span><span class="o">.</span><span class="n">info</span>
</pre></div>
</div>
<p>Subsequent postrefinenment/merging programs can be called on an output
cluster.lst file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&gt;&gt;&gt; prime.postrefine params.phil $(cat cluster.lst)
</pre></div>
</div>
<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>data</em>, <em>cname='cluster'</em>, <em>info=''</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a cluster from a list of SingleFrame objects, as well as information
about these as a cluster (e.g. mean unit cell).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>data</strong> – a list of SingleFrame objects</li>
<li><strong>cname</strong> – the name of the cluster, as a string.</li>
<li><strong>info</strong> – an info-string for the cluster.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.__len__">
<code class="descname">__len__</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__len__" title="Permalink to this definition">¶</a></dt>
<dd><p>Number of images in the cluster</p>
</dd></dl>

<dl class="attribute">
<dt id="xfel.clustering.cluster.Cluster.__module__">
<code class="descname">__module__</code><em class="property"> = 'xfel.clustering.cluster'</em><a class="headerlink" href="#xfel.clustering.cluster.Cluster.__module__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.ab_cluster">
<code class="descname">ab_cluster</code><span class="sig-paren">(</span><em>threshold=10000</em>, <em>method='distance'</em>, <em>linkage_method='single'</em>, <em>log=False</em>, <em>ax=None</em>, <em>write_file_lists=True</em>, <em>schnell=False</em>, <em>doplot=True</em>, <em>labels='default'</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.ab_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Hierarchical clustering using the unit cell dimentions.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>threshold</strong> – the threshold to use for prunning the tree into clusters.</li>
<li><strong>method</strong> – which clustering method from scipy to use when creating the tree (see scipy.cluster.hierarchy)</li>
<li><strong>linkage_method</strong> – which linkage method from scipy to use when creating the linkages. x (see scipy.cluster.hierarchy)</li>
<li><strong>log</strong> – if True, use log scale on y axis.</li>
<li><strong>ax</strong> – if a matplotlib axes object is provided, plot to this. Otherwise, create a new axes object and display on screen.</li>
<li><strong>write_file_lists</strong> – if True, write out the files that make up each cluster.</li>
<li><strong>schnell</strong> – if True, use simple euclidian distance, otherwise, use Andrews-Berstein distance from Andrews &amp; Bernstein J Appl Cryst 47:346 (2014) on the Niggli cells.</li>
<li><strong>doplot</strong> – Boolean flag for if the plotting should be done at all.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Runs faster if switched off.
:param labels: ‘default’ will not display any labels for more than 100 images, but will display file names for fewer. This can be manually overidden with a boolean flag.
:return: A list of Clusters ordered by largest Cluster to smallest</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use ‘schnell’ option with caution, since it can cause strange behaviour
around symmetry boundaries.</p>
</div>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.all_frames_intensity_stats">
<code class="descname">all_frames_intensity_stats</code><span class="sig-paren">(</span><em>ax=None</em>, <em>smoothing_width=2000</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.all_frames_intensity_stats" title="Permalink to this definition">¶</a></dt>
<dd><p>Goes through all frames in the cluster, and plots all the partial intensites.
Then does a linear fit and rolling average on these.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>smoothing_width</strong> – the width of the smoothing window.</li>
<li><strong>ax</strong> – Optional matplotlib axes object to plot to. Otherwise, plot to screen.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">the axis, with the data plotted onto it.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.best_by_CC">
<code class="descname">best_by_CC</code><span class="sig-paren">(</span><em>other</em>, <em>assert_is_similar_symmetry=False</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.best_by_CC" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the SingleFrame object with the highest CC to a reference miller array.
:param other: miller array object to be correlated against
:return: a SingleFrame object.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.dump_as_mtz">
<code class="descname">dump_as_mtz</code><span class="sig-paren">(</span><em>mtz_name</em>, <em>use_fullies=False</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.dump_as_mtz" title="Permalink to this definition">¶</a></dt>
<dd><p>Merge using weighted mean and standard deviation if all miller arrays</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.dump_file_list">
<code class="descname">dump_file_list</code><span class="sig-paren">(</span><em>out_file_name=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.dump_file_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Dumps a list of paths to inegration pickle files to a file. One
line per image. Provides easy input into post-refinement programs.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>out_file_name</strong> – the output file name.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="classmethod">
<dt id="xfel.clustering.cluster.Cluster.from_crystal_symmetries">
<em class="property">classmethod </em><code class="descname">from_crystal_symmetries</code><span class="sig-paren">(</span><em>crystal_symmetries</em>, <em>lattice_ids=None</em>, <em>_prefix='cluster_from_crystal_symmetries'</em>, <em>_message='Made from list of individual cells'</em>, <em>n_images=None</em>, <em>dials=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_crystal_symmetries" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from a list of crystal symmetries.</p>
</dd></dl>

<dl class="classmethod">
<dt id="xfel.clustering.cluster.Cluster.from_directories">
<em class="property">classmethod </em><code class="descname">from_directories</code><span class="sig-paren">(</span><em>path_to_integration_dir</em>, <em>_prefix='cluster_from_dir'</em>, <em>n_images=None</em>, <em>dials=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_directories" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from pickle files, from the recursively
walked paths. Can take more than one argument for multiple folders.
usage: Cluster.from_directories(..)
:param path_to_integration_dir: list of directories containing pickle files.
Will be searched recursively.
:param n_images: find at most this number of images.
:param use_b: Boolean. If True, intialise Scale and B. If False, use only
mean intensity scalling.</p>
</dd></dl>

<dl class="classmethod">
<dt id="xfel.clustering.cluster.Cluster.from_expts">
<em class="property">classmethod </em><code class="descname">from_expts</code><span class="sig-paren">(</span><em>refl_table=None</em>, <em>expts_list=None</em>, <em>_prefix='cluster_from_file'</em>, <em>_message='Made from experiment objects'</em>, <em>n_images=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_expts" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from experiment and reflection list objects
:param refl_table: DIALS integrated reflection table
:param expts_list: DIALS experiment list
:param n_images: find at most this number of images</p>
</dd></dl>

<dl class="classmethod">
<dt id="xfel.clustering.cluster.Cluster.from_files">
<em class="property">classmethod </em><code class="descname">from_files</code><span class="sig-paren">(</span><em>raw_input=None</em>, <em>pickle_list=[]</em>, <em>dials_refls=[]</em>, <em>dials_expts=[]</em>, <em>_prefix='cluster_from_file'</em>, <em>_message='Made from list of individual files'</em>, <em>n_images=None</em>, <em>dials=False</em>, <em>json=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from a list of individual files.
:param pickle_list: list of pickle files
:param dials_refls: list of DIALS integrated reflections
:param dials_expts: list of DIALS experiment jsons
:param n_images: find at most this number of images
:param dials: use the dials_refls and dials_expts arguments to construct the clusters (default: False)
:param use_b: Boolean. If True, intialise Scale and B. If False, use only
mean intensity scalling.</p>
</dd></dl>

<dl class="classmethod">
<dt id="xfel.clustering.cluster.Cluster.from_iterable">
<em class="property">classmethod </em><code class="descname">from_iterable</code><span class="sig-paren">(</span><em>iterable</em>, <em>_prefix='cluster_from_iterable'</em>, <em>_message='Made from list of individual cells'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_iterable" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from an iterable (a list or tuple).  The
file must list unit cell a,b,c,alpha,beta,gamma and space_group_type,
each as a single token.
:param iterable: a list or a tuple</p>
</dd></dl>

<dl class="classmethod">
<dt id="xfel.clustering.cluster.Cluster.from_list">
<em class="property">classmethod </em><code class="descname">from_list</code><span class="sig-paren">(</span><em>file_name</em>, <em>raw_input=None</em>, <em>pickle_list=[]</em>, <em>dials_refls=[]</em>, <em>dials_expts=[]</em>, <em>_prefix='cluster_from_file'</em>, <em>_message='Made from list of individual cells'</em>, <em>n_images=None</em>, <em>dials=False</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.from_list" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor to get a cluster from a single file.  The file must list unit cell a,b,c,alpha,beta,gamma
and space_group_type, each as a single token.
:param file_name: pathname of the file</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.intensity_statistics">
<code class="descname">intensity_statistics</code><span class="sig-paren">(</span><em>ax=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.intensity_statistics" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses the per-frame B and G fits (gradient and intercept of the ln(i) vs
(sin(theta)/lambda)**2 plot) to create three agregate plots:
1) histogram of standard errors on the per-frame fits
2) histogram of B factors
3) scatter  plot of intercept vs. gradient (G vs. B)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>ax</strong> – optionally hand the method three matplotlib axes objects to plot onto. If not specified, will plot the data.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">the three axes, with the data plotted onto them.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.make_sub_cluster">
<code class="descname">make_sub_cluster</code><span class="sig-paren">(</span><em>new_members</em>, <em>new_prefix</em>, <em>new_info</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.make_sub_cluster" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a sub-cluster from a list of SingleFrame objects from the old
SingleFrame array.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>new_members</strong> – a new set of SingleFrame objects, typically a subset of</td>
</tr>
</tbody>
</table>
<p>the current cluster.
:param new_prefix: prefix to be passed directly to __init__
:param new_info: new information about this cluster. This is inteligently
appended to the old info string so that the history of sub-clusters is
tracted.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.merge_dict">
<code class="descname">merge_dict</code><span class="sig-paren">(</span><em>use_fullies=False</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.merge_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a dict of Miller indices with  ([list of intensities], resolution)
value tuples for each miller index.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.point_group_filter">
<code class="descname">point_group_filter</code><span class="sig-paren">(</span><em>point_group</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.point_group_filter" title="Permalink to this definition">¶</a></dt>
<dd><p>Return all the SingleFrames that have a given pointgroup.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.prime_postrefine">
<code class="descname">prime_postrefine</code><span class="sig-paren">(</span><em>inputfile</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.prime_postrefine" title="Permalink to this definition">¶</a></dt>
<dd><p>Run postrefinement from Prime on a cluster. Implements the prime API, and updates the SingleFrame objects with the attribute <cite>miller_fullies</cite>.
:param cluster: a cluster object.
:param inputfile: a Prime .inp file.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.print_ucs">
<code class="descname">print_ucs</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.print_ucs" title="Permalink to this definition">¶</a></dt>
<dd><p>Prints a list of all the unit cells in the cluster to CSV.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.to_pandas">
<code class="descname">to_pandas</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.to_pandas" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.total_intensity_filter">
<code class="descname">total_intensity_filter</code><span class="sig-paren">(</span><em>res=''</em>, <em>completeness_threshold=0.95</em>, <em>plot=False</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.total_intensity_filter" title="Permalink to this definition">¶</a></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This is still in development, use at own risk!</p>
</div>
<p>Creates an optimal sub-cluster using the fewest images that fulfil the
criteria defined by:
:param res: desired resolution. Defaults to that of the dataset.
:param completeness: the desired completeness of the subset
:param multiplicity: the desired multiplicity of the subset</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.uc_feature_vector">
<code class="descname">uc_feature_vector</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.uc_feature_vector" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a len(cluster) * 6 numpy array of features for use in ML algos</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.cluster.Cluster.visualise_orientational_distribution">
<code class="descname">visualise_orientational_distribution</code><span class="sig-paren">(</span><em>axes_to_return=None</em>, <em>cbar=True</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster.Cluster.visualise_orientational_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a plot of the orientational distribution of the unit cells.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>axes_to_return</strong> – if None, print to screen, otherwise, requires 3 axes objects, and will return them.</li>
<li><strong>cbar</strong> – boolean to specify if a color bar should be used.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-xfel.clustering.cluster_groups">
<span id="xfel-clustering-cluster-groups-module"></span><h2>xfel.clustering.cluster_groups module<a class="headerlink" href="#module-xfel.clustering.cluster_groups" title="Permalink to this headline">¶</a></h2>
<p>Utilitites for dealing with lists of clusters.</p>
<dl class="function">
<dt id="xfel.clustering.cluster_groups.unit_cell_info">
<code class="descclassname">xfel.clustering.cluster_groups.</code><code class="descname">unit_cell_info</code><span class="sig-paren">(</span><em>sub_clusters</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.cluster_groups.unit_cell_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Print unit cell information for a list of clusters.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>sub_clusters</strong> – a list of cluster objects</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">a string containing median unit cells, standard deviations and
point group composition of each cluster.</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-xfel.clustering.singleframe">
<span id="xfel-clustering-singleframe-module"></span><h2>xfel.clustering.singleframe module<a class="headerlink" href="#module-xfel.clustering.singleframe" title="Permalink to this headline">¶</a></h2>
<p>Module for working with single images in a serial crystallography
dataset</p>
<div class="section" id="singleframe-singleframe">
<h3>singleframe.SingleFrame<a class="headerlink" href="#singleframe-singleframe" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="xfel.clustering.singleframe.SingleFrame">
<em class="property">class </em><code class="descclassname">xfel.clustering.singleframe.</code><code class="descname">SingleFrame</code><span class="sig-paren">(</span><em>path=None</em>, <em>filename=None</em>, <em>crystal_num=0</em>, <em>remove_negative=False</em>, <em>use_b=True</em>, <em>scale=True</em>, <em>dicti=None</em>, <em>pixel_size=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">xfel.clustering.api.InputFrame</span></code></p>
<p>Class that creates single-image agregate metrics/scoring that can then be
used in downstream clustering or filtering procedures.</p>
<dl class="attribute">
<dt id="xfel.clustering.singleframe.SingleFrame.ANGSTROMS_TO_EV">
<code class="descname">ANGSTROMS_TO_EV</code><em class="property"> = 12398.425</em><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.ANGSTROMS_TO_EV" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.__init__">
<code class="descname">__init__</code><span class="sig-paren">(</span><em>path=None</em>, <em>filename=None</em>, <em>crystal_num=0</em>, <em>remove_negative=False</em>, <em>use_b=True</em>, <em>scale=True</em>, <em>dicti=None</em>, <em>pixel_size=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.__init__" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructor for SingleFrame object, using a cctbx.xfel integration pickle.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>path</strong> – path to integration pickle</li>
<li><strong>filename</strong> – the file name alone (used as a label)</li>
<li><strong>crystal_num</strong> – if multiple lattices present, the latice number.</li>
<li><strong>remove_negative</strong> – Boolean for removal of negative intensities</li>
<li><strong>use_b</strong> – if True, initialise scale and B, if false, use only mean-intensity scaling.</li>
<li><strong>dicti</strong> – optional. If a dictionairy is supplied here, will create object from that rather than attempting to read the file specified in path, filename.</li>
<li><strong>pixel_size</strong> – the size of pixels in mm. Defaults to a MAR detector with a warning at debug level of logging.</li>
<li><strong>scale</strong> – if False, will intialise scales to G=1, B=0.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">a SingleFrame object, with the following Object attributes:</p>
</td>
</tr>
</tbody>
</table>
<dl class="docutils">
<dt>Object attributes are:</dt>
<dd><ul class="first last simple">
<li><cite>is_polarization_corrected</cite>: Boolean flag indicatinf if polarization correction has been applied</li>
<li><cite>miller_array</cite>: the cctbx.miller miller array of spot intensities.</li>
<li><cite>mapped_predictions</cite>: the mapped_predictions locations</li>
<li><cite>path</cite>: full path to the original file</li>
<li><cite>name</cite>: file-name, used as an identifier</li>
<li><a href="#id1"><span class="problematic" id="id2">`</span></a>crystal_system:</li>
<li><cite>pg</cite>: point group of pickle</li>
<li><cite>uc</cite>: Niggli unit cell as a tuple</li>
<li><cite>orientation</cite>: cctbx crystal_orientation object</li>
<li><cite>total_i</cite>: the total integrated intensity for this frame</li>
<li><cite>xbeam</cite>: x-location of beam centre</li>
<li><cite>ybeam</cite>: y-location of beam centre</li>
<li><a href="#id3"><span class="problematic" id="id4">`</span></a>wavelength:</li>
<li><cite>spot_offset</cite>: the mean offset between observed spots and predicted centroids. Only created if integration was performed using verbose_cv=True. Otherwise None.</li>
<li><cite>minus_2B</cite>: the gradient of the ln(i) vs. sinsqtheta_over_lambda_sq plot</li>
<li><cite>G</cite>: intercept of the of the ln(i) vs. sinsqtheta_over_lambda_sq plot</li>
<li><cite>log_i</cite>: list of log_i intensities</li>
<li><cite>sinsqtheta_over_lambda_sq</cite>: list of sinsqtheta_over_lambda_sq</li>
<li><cite>wilson_err</cite>: standard error on the fit of ln(i) vs. sinsqtheta_over_lambda_sq</li>
<li><cite>miller_fullies</cite>: a cctbx.miller array of fully recorded intensites.</li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="attribute">
<dt id="xfel.clustering.singleframe.SingleFrame.__module__">
<code class="descname">__module__</code><em class="property"> = 'xfel.clustering.singleframe'</em><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.__module__" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.distance_from">
<code class="descname">distance_from</code><span class="sig-paren">(</span><em>other_uc</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.distance_from" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculates distance using NCDist from Andrews and Bernstein J. Appl.
Cryst. 2014 between this frame and some other unit cell.
:param:other_uc: a 6-tuple of a, b, c, alpha, beta, gamma for some unit cell
:return: the NCDist in A^2 to other_uc</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.filter_negative_intensities">
<code class="descname">filter_negative_intensities</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.filter_negative_intensities" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters negative intensities from the Miller array. Acts in place.
:return: acts in place.</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.init_calc_wilson">
<code class="descname">init_calc_wilson</code><span class="sig-paren">(</span><em>use_b_factor</em>, <em>i_corrections=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.init_calc_wilson" title="Permalink to this definition">¶</a></dt>
<dd><p>If use_b_factor is
:param i_corrections: allows flex array of correction factors (e.g. partialities) to be specified
:param use_b_factor: if True, do a linear regression to fit G and B and returns the coeficients minus_2B, G, the transformed data log_i, and one_over_d_sqare. Also returns fit_stats, which is a dictionairy. If use_b_factor is False, then B is 0, and G is the mean intensity of the image. The r_value is then 0 (by definition), and the std_err is the standard error on the mean.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name" colspan="2">Return minus_2B, G, log_i, on_over_d_square:</th></tr>
<tr class="field-odd field"><td>&#160;</td><td class="field-body"><cite>minus_2B</cite>: gradient of fit; <cite>G</cite>: intercept of fit; <cite>log_i</cite>: dependent variable of fit; <cite>one_over_d_square</cite>: independent variable of fit.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="staticmethod">
<dt id="xfel.clustering.singleframe.SingleFrame.make_g6">
<em class="property">static </em><code class="descname">make_g6</code><span class="sig-paren">(</span><em>uc</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.make_g6" title="Permalink to this definition">¶</a></dt>
<dd><p>Take a reduced Niggli Cell, and turn it into the G6 representation</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.n_reflections_by_sigi">
<code class="descname">n_reflections_by_sigi</code><span class="sig-paren">(</span><em>sig_i_cuttoff</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.n_reflections_by_sigi" title="Permalink to this definition">¶</a></dt>
<dd><p>Currently a placeholder that returns None.</p>
<p>This method should return the number of reflection in the frame that have an
I/sig(I) &gt; sig_i_cuttoff</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.plot_wilson">
<code class="descname">plot_wilson</code><span class="sig-paren">(</span><em>width=30</em>, <em>ax=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.plot_wilson" title="Permalink to this definition">¶</a></dt>
<dd><p>Makes a log(I) vs 1/d**2 plot, displaying the raw partial data, a
rolling average of the data, and the Wilson model fit to the data.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Param:</th><td class="field-body">width: smoothing window size</td>
</tr>
<tr class="field-even field"><th class="field-name">Param:</th><td class="field-body">ax: optional axes object to ve used for plotting</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.polarization_correction">
<code class="descname">polarization_correction</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.polarization_correction" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform basic polarization correction in place, and change the
is_polarization_corrected flag to True.</p>
<p>I_corrected = 2*I_uncorrected/(1 + cos(two_theta)**2)</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.to_panda">
<code class="descname">to_panda</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.to_panda" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the object attributes as a pandas series</p>
</dd></dl>

<dl class="method">
<dt id="xfel.clustering.singleframe.SingleFrame.trim_res_limit">
<code class="descname">trim_res_limit</code><span class="sig-paren">(</span><em>d_min=None</em>, <em>d_max=None</em><span class="sig-paren">)</span><a class="headerlink" href="#xfel.clustering.singleframe.SingleFrame.trim_res_limit" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all miller indicies outside the range of _d_min, _d_max.
Changes the object in place.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>d_min</strong> – min res of new miller array. Defaults to current value.</li>
<li><strong>d_max</strong> – max res of new miller array. Defaults to current value.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">xfel.clustering package</a><ul>
<li><a class="reference internal" href="#module-xfel.clustering.cluster">xfel.clustering.cluster module</a><ul>
<li><a class="reference internal" href="#cluster-cluster">cluster.Cluster</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-xfel.clustering.cluster_groups">xfel.clustering.cluster_groups module</a></li>
<li><a class="reference internal" href="#module-xfel.clustering.singleframe">xfel.clustering.singleframe module</a><ul>
<li><a class="reference internal" href="#singleframe-singleframe">singleframe.SingleFrame</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/xfel/xfel.clustering.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">CCTBX Developer documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2014, University of California.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>